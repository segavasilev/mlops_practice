# Лабораторная работа 1
* В рамках работы создан простейший конвейер для автоматизации работы с моделью машинного обучения. 
* Отдельные этапы конвейера машинного обучения описываются в разных python–скриптах, которые потом соединяются в единую цепочку действий с помощью bash-скрипта.

Этапы:
1. Создание python-скрипта (data_creation.py), который создает наборы данных метеорологических наблюдений для определенного местоположения. Часть наборов данных сохраняется в папке “train”, другая часть в папке “test”.
2. Создание python-скрипта (data_preprocessing.py), который выполняет предобработку данных. Трансформации выполняются и над тестовой и над обучающей выборкой. 
3. Создание python-скрипта (model_preparation.py), который создает и обучает модель машинного обучения на построенных данных из папки “train”. При обучении модели используется библиотека [сatboost](https://catboost.ai/) . Предстказанния строятся для модели регрессии, обученной с помощью CatBoostRegressor. Для сохранения модели в файл используется [pickle](https://docs.python.org/3/library/pickle.html)
4. Создание python-скрипта (model_testing.py), проверяющего модель машинного обучения на построенных данных из папки “test”.
5. Написание bash-скрипта (pipeline.sh), последовательно запускающего все python-скрипты. В результате выполнения скрипта на терминал в стандартный поток вывода печатается одна строка с оценкой метрики на вашей модели, например:

```shell
Model test accuracy is: 0.876
```
## Этап 1.
Скрипт data_creation.py создает наборы данных метеорологических наблюдений для определенного местоположения. Часть наборов данных сохраняется в папке “train”, другая часть в папке “test”. 
Для получения данных используется библиотека [meteostat](https://pypi.org/project/meteostat/).
Детальное описание получаемых данных можно найти в [документации](https://dev.meteostat.net/python/hourly.html).

Помимо загрузки данных скрипт создает папки "train" и "test" и сохраняет в них полученные данные после разделения на обучающую и тестовую выборки.

Для запуска скрипта необходимо передать в качестве аргументов:
* Имя папки, в которую будут сохранены тестовые данные. По умолчанию "test". Необязательный аргумент. Флаг --test_data_path.
* Имя файла, в который будут сохранены тестовые данные. По умолчанию "test.csv". Необязательный аргумент. Флаг --origin_test_file_name.
* Имя папки, в которую будут сохранены обучающие данные. По умолчанию "train". Необязательный аргумент. Флаг --train_data_path.
* Имя файла, в который будут сохранены обучающие данные. По умолчанию "train.csv". Необязательный аргумент. Флаг --origin_train_file_name.
* Координаты местоположения, для которого необходимо получить данные. Широта вформате float. Обязательный аргумент. Флаг --lat.
* Координаты местоположения, для которого необходимо получить данные. Долгота в формате float. Обязательный аргумент. Флаг --lon.
* Координаты местоположения, для которого необходимо получить данные. Высота над уровнем моря в метрах в формате float. Необязательный аргумент. Флаг --alt.
* Дата начала периода, за который необходимо получить данные. В формате "YYYY-MM-DD HH:MM::SS". Обязательный аргумент. Флаг --start_date.
* Дата окончания периода, за который необходимо получить данные. В формате "YYYY-MM-DD HH:MM::SS". Обязательный аргумент. Флаг --end_date.

Пример команды для запуска скрипта:
```python
python3 data_creation.py --lat 7.8804 --lon 98.3923 --alt 10.0 --start_date "2020-01-01 00:00:00" --end_date "2020-1-31 23:00:00"
```

## Этап 2.
Скрипт data_preprocessing.py выполняет предобработку данных. Трансформации выполняются и над тестовой и над обучающей выборкой, которые были получены на предыдущем этапе.
Для обработки данных используется библиотека [pandas](https://pandas.pydata.org/).

Поскольку в коде реализована модель регрессии, построенная с помощью CatBoostRegressor, то в качестве предобработки выполним только обогащение данных. Для этого добавляются новые признаки временного лага.

Результаты предобработки сохраняются в папках "train" и "test".

Для запуска скрипта необходимо передать в качестве аргументов:
* Имя папки, в которой находятся тестовые данные. По умолчанию "test". Необязательный аргумент. Флаг --test_data_path.
* Имя файла, в котором находятся тестовые данные. По умолчанию "test.csv". Необязательный аргумент. Флаг --origin_test_file_name.
* Имя папки, в которой находятся обучающие данные. По умолчанию "train". Необязательный аргумент. Флаг --train_data_path.
* Имя файла, в котором находятся обучающие данные. По умолчанию "train.csv". Необязательный аргумент. Флаг --origin_train_file_name.
* Имя файла, в который будут сохранены обработанные обучающие данные. По умолчанию "prepared_train.csv". Необязательный аргумент. Флаг --prepared_train_file_name.
* Имя файла, в который будут сохранены обработанные тестовые данные. По умолчанию "prepared_test.csv". Необязательный аргумент. Флаг --prepared_test_file_name.
* Имя целевой переменной. По умолчанию "rhum". Необязательный аргумент. Флаг --target_variable.

Пример команды для запуска скрипта:
```python
python3 data_preprocessing.py --target_variable "rhum"
```

## Этап 3.
Скрипт model_preparation.py создает и обучает модель машинного обучения на подготовленных данных из папки “train”. При обучении модели используется библиотека [сatboost](https://catboost.ai/) . Предстказанния строятся для модели регрессии, обученной с помощью CatBoostRegressor. Для сохранения модели в файл используется [pickle](https://docs.python.org/3/library/pickle.html).

Для запуска скрипта необходимо передать в качестве аргументов:
* Имя папки, в которой находятся обработанные обучающие данные. По умолчанию "train". Необязательный аргумент. Флаг --train_data_path.
* Имя файла, в котором находятся обработанные обучающие данные. По умолчанию "prepared_train.csv". Необязательный аргумент. Флаг --prepared_train_file_name.
* Имя папки, в которой будет сохранена модель. По умолчанию "model". Необязательный аргумент. Флаг --model_path.
* Имя файла, в который будет сохранена модель. По умолчанию "model.pkl". Необязательный аргумент. Флаг --model_file_name.

Пример команды для запуска скрипта:
```python
python3 model_preparation.py
```

## Этап 4.
Скрипт model_testing.py проверяет модель машинного обучения на подготовленных данных из папки “test”.

Тестирование выполняется на основе метрики mse (среднеквадратичная ошибка).

Для запуска скрипта необходимо передать в качестве аргументов:
* Имя папки, в которой находятся обработанные тестовые данные. По умолчанию "test". Необязательный аргумент. Флаг --test_data_path.
* Имя файла, в котором находятся обработанные тестовые данные. По умолчанию "prepared_test.csv". Необязательный аргумент. Флаг --prepared_test_file_name.
* Имя папки, в которой находится модель. По умолчанию "model". Необязательный аргумент. Флаг --model_path.
* Имя файла, в котором находится модель. По умолчанию "model.pkl". Необязательный аргумент. Флаг --model_file_name.
* Имя целевой переменной. По умолчанию "rhum". Необязательный аргумент. Флаг --target_variable.

Пример команды для запуска скрипта:
```python
python3 model_testing.py
```

## Этап 5.
Bash-скрипт pipeline.sh последовательно запускает все python-скрипты. В результате выполнения скрипта на терминал в стандартный поток вывода печатается одна строка с оценкой метрики на вашей модели.
Помимо необходимого вывода в стандартный поток вывода могут быть добавлены дополнительные сообщения о ходе выполнения скрипта.

Перед запуском скриптов в баш-скрипте предусмотрены:
* Определение переменных, которые будут использоваться в скриптах.
* Создание виртуального окружения, его активация и установка необходимых библиотек из файла requirements.txt.
* Запуск скриптов data_creation.py, data_preprocessing.py, model_preparation.py, model_testing.py.
* Деактивация виртуального окружения.